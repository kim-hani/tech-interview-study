# PCB와 문맥 교환

---

## 1. PCB(Process Control Block)란?

**프로세스 제어 블록(PCB)** 은 운영체제가 프로세스를 관리하기 위해 사용하는 핵심 자료구조이다.  
PCB는 프로세스의 “신분증(ID)”과 같은 역할을 하며, 운영체제는 PCB를 통해 프로세스를 식별하고 관리한다.

프로세스가 생성될 때 운영체제는 PCB를 생성하여 커널 공간에 저장하고, 프로세스가 종료되면 PCB도 제거된다.

### PCB의 구성 요소
1. **프로세스 식별자 (PID, Process ID)**  
   - 각 프로세스를 구분하기 위한 고유 번호  

2. **프로세스 상태 (Process State)**  
   - New, Ready, Running, Waiting, Terminated 상태  

3. **프로그램 카운터 (Program Counter)**  
   - 다음에 실행할 명령어의 주소  

4. **레지스터 값 (Registers)**  
   - CPU 연산에 필요한 다양한 레지스터 값  
   - 일반 레지스터, 스택 포인터, 프로그램 카운터 등이 포함  

5. **메모리 관리 정보 (Memory Management Information)**  
   - 프로세스가 사용하는 주소 공간, 페이지 테이블, 세그먼트 테이블 등  

6. **CPU 스케줄링 정보 (CPU Scheduling Information)**  
   - 우선순위(priority), 스케줄링 큐 위치, 시간 할당량 등  

7. **입출력 상태 정보 (I/O Status Information)**  
   - 열린 파일 리스트, 사용 중인 입출력 장치 등  

---

## 2. 문맥 교환(Context Switching)란?

**문맥 교환(Context Switching)** 은 CPU가 현재 실행 중인 프로세스의 상태를 PCB에 저장하고,  
다른 프로세스의 PCB에서 상태를 불러와 실행을 전환하는 과정을 의미한다.  

CPU는 동시에 여러 프로세스를 실행할 수 없기 때문에, 빠르게 프로세스를 교체하여 다중 프로그래밍 환경을 제공한다.

### 문맥 교환 과정
1. 실행 중인 프로세스의 레지스터 값, 프로그램 카운터 등을 해당 프로세스의 PCB에 저장한다.  
2. 스케줄러(Scheduler)가 새로운 프로세스를 선택한다.  
3. 선택된 프로세스의 PCB에서 이전에 저장된 상태 정보를 CPU 레지스터에 복원한다.  
4. CPU가 새로운 프로세스의 명령어를 실행한다.  

### 문맥 교환의 비용
- 문맥 교환은 CPU가 실제 작업(유저 프로그램 실행)이 아닌 관리 작업을 수행하는 것이므로 **오버헤드**가 발생한다.  
- 캐시(CPU Cache), TLB(Translation Lookaside Buffer) 등이 초기화되며 성능 저하를 유발할 수 있다.  
- 따라서 운영체제는 문맥 교환 빈도를 최소화하면서 공정성과 응답성을 보장해야 한다.  

---

## 3. 프로세스 문맥 교환 vs 스레드 문맥 교환

| 구분 | 프로세스 문맥 교환 | 스레드 문맥 교환 |
|------|------------------|------------------|
| 교환 단위 | PCB (프로세스 단위) | TCB(Thread Control Block) 또는 스택 레벨 |
| 메모리 공간 | 독립된 주소 공간 필요 | 같은 프로세스 내 공유된 메모리 공간 사용 |
| 비용 | 높음 (메모리 맵핑, 캐시/TLB 초기화) | 낮음 (스택, 레지스터만 교체) |
| 효율성 | 낮음 | 높음 |

- **프로세스 전환** : 운영체제가 다른 프로세스로 CPU를 전환 → 비용이 크다.  
- **스레드 전환** : 동일한 프로세스 내에서 실행 흐름만 교체 → 비용이 적다.  

---

## 4. 문맥 교환이 중요한 이유

- 다중 프로그래밍 환경에서 **CPU 활용률을 극대화**하기 위해 필수적이다.  
- 사용자에게는 동시에 여러 프로그램이 실행되는 것처럼 보이도록 한다.  
- 선점형 스케줄링(Preemptive Scheduling) 환경에서는 문맥 교환이 자주 발생한다.  

---

## 5. 정리

- **PCB** : 프로세스의 상태를 저장하는 운영체제의 핵심 자료구조  
- **문맥 교환** : CPU가 다른 프로세스(또는 스레드)로 전환하기 위해 상태를 저장하고 복원하는 과정  
- **프로세스 문맥 교환** : 비용이 크며 주소 공간까지 교체  
- **스레드 문맥 교환** : 비용이 적고, 같은 주소 공간 내에서 수행됨  

운영체제는 문맥 교환을 통해 CPU와 자원을 효율적으로 배분하고, 공정성과 반응성을 보장한다.
